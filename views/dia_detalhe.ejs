<%- include("partials/header", { tituloPagina: tituloPagina }) %>

<section class="kst-container">

  <!-- T√≠tulo principal -->
  <div class="kst-home-header">
    <h1 class="kst-home-title">Detalhes do dia</h1>
    <p class="kst-home-subtitle">Resumo completo do seu desempenho di√°rio.</p>
  </div>

  <!-- CARD RESUMO DO DIA -->
  <div class="kst-card kst-day-hero">

    <div class="kst-day-hero-top">
      <div>
        <h2 class="kst-day-date"><%= dia.data %></h2>
        <p class="kst-day-subinfo">
          <% if (dia.horas_estudo_liquidas) { %>
            <strong><%= dia.horas_estudo_liquidas %> h</strong> de estudo ‚Äî
          <% } %>
          <% if (dia.questoes_feitas_total != null) { %>
            <strong><%= dia.questoes_feitas_total %></strong> quest√µes
          <% } %>
        </p>
      </div>

      <% if (dia.humor) { %>
        <span class="kst-badge kst-badge-humor <%= dia.humor.toLowerCase() %>">
          <% if (dia.humor === "BOM") { %> üòÑ Bom <% } %>
          <% if (dia.humor === "OK") { %> üòê Ok <% } %>
          <% if (dia.humor === "RUIM") { %> üòû Ruim <% } %>
        </span>
      <% } %>
    </div>

    <!-- KPIs -->
    <div class="kst-day-kpi-grid">

      <div class="kst-day-kpi">
        <span class="kst-day-kpi-label">Sono</span>
        <span class="kst-day-kpi-value">
          <%= dia.horas_sono_total || "-" %> h
        </span>
      </div>

      <div class="kst-day-kpi">
        <span class="kst-day-kpi-label">Estudo</span>
        <span class="kst-day-kpi-value">
          <%= dia.horas_estudo_liquidas || 0 %> h
        </span>
      </div>

      <div class="kst-day-kpi">
        <span class="kst-day-kpi-label">Foco</span>
        <span class="kst-day-kpi-value">
          <%= dia.nivel_foco != null ? dia.nivel_foco : "-" %>/10
        </span>
      </div>

      <div class="kst-day-kpi">
        <span class="kst-day-kpi-label">Energia</span>
        <span class="kst-day-kpi-value">
          <%= dia.nivel_energia != null ? dia.nivel_energia : "-" %>/10
        </span>
      </div>

    </div>
  </div>

  <!-- üìå INSIGHTS AUTOM√ÅTICOS -->
  <% if (insights && insights.length > 0) { %>
  <div class="kst-card kst-day-section" style="margin-top: 2rem;">
    <h3 class="kst-day-section-title">Insights autom√°ticos do seu dia</h3>
    
    <ul class="kst-day-info">
      <% insights.forEach(function(i){ %>
        <li style="margin-bottom: .4rem;"><%= i %></li>
      <% }) %>
    </ul>
  </div>
  <% } %>

  <!-- SE√á√ïES DETALHADAS -->
  <div class="kst-day-sections">

    <!-- SONO -->
    <div class="kst-card kst-day-section">
      <h3 class="kst-day-section-title">Sono e rotina</h3>
      <ul class="kst-day-info">
        <li><strong>Hora que acordou:</strong> <%= dia.hora_acordou || "-" %></li>
        <li><strong>Hora que dormiu:</strong> <%= dia.hora_dormiu || "-" %></li>
        <li><strong>Horas totais:</strong> <%= dia.horas_sono_total || "-" %></li>
        <li><strong>Qualidade do sono:</strong> <%= dia.qualidade_sono_nota != null ? dia.qualidade_sono_nota : "-" %>/10</li>
        <li><strong>Tirou soneca?</strong> 
          <%= dia.tirou_soneca == null ? "-" : (dia.tirou_soneca ? "Sim" : "N√£o") %>
        </li>
        <li><strong>Minutos de soneca:</strong> <%= dia.minutos_soneca != null ? dia.minutos_soneca : "-" %></li>
      </ul>
    </div>

    <!-- ESTUDOS -->
    <div class="kst-card kst-day-section">
      <h3 class="kst-day-section-title">Estudos (resumo do dia)</h3>
      <ul class="kst-day-info">
        <li><strong>Horas l√≠quidas:</strong> <%= dia.horas_estudo_liquidas || "-" %></li>
        <li><strong>Total de quest√µes:</strong> <%= dia.questoes_feitas_total != null ? dia.questoes_feitas_total : "-" %></li>
        <li><strong>Acertos:</strong> <%= dia.questoes_acertos_total != null ? dia.questoes_acertos_total : "-" %></li>
      </ul>

      <% if (dia.estudos_materias && dia.estudos_materias.length) { %>
        <h4 class="kst-day-subtitle">Estudos por mat√©ria</h4>
        <ul class="kst-day-list">
          <% dia.estudos_materias.forEach(function(e) { %>
            <li>
              <strong><%= e.materia ? e.materia.nome : "Mat√©ria" %>:</strong>
              <%= e.minutos_estudados || 0 %> min ‚Äî
              <%= e.questoes_certas || 0 %>/<%= e.questoes_feitas || 0 %> quest√µes
            </li>
          <% }) %>
        </ul>
      <% } %>
    </div>

    <!-- SIMULADOS -->
    <% if (dia.simulados && dia.simulados.length) { %>
      <div class="kst-card kst-day-section">
        <h3 class="kst-day-section-title">Simulados nesse dia</h3>
        <ul class="kst-day-list">
          <% dia.simulados.forEach(function(s) { %>
            <li>
              <strong>Simulado:</strong>
              <% if (s.tempo_total_minutos != null) { %>
                <%= s.tempo_total_minutos %> min
              <% } else { %>
                tempo n√£o informado
              <% } %>
              <% if (s.resultado_resumo) { %> ‚Äî <%= s.resultado_resumo %> <% } %>
              <% if (s.area_que_mais_errou) { %> (mais errou: <%= s.area_que_mais_errou %>) <% } %>
              [<a href="/simulados/<%= s.id %>" class="kst-link-inline">ver detalhes</a>]
            </li>
          <% }) %>
        </ul>
      </div>
    <% } %>

    <!-- REFLEX√ÉO -->
    <div class="kst-card kst-day-section">
      <h3 class="kst-day-section-title">Reflex√£o</h3>
      <ul class="kst-day-info">
        <li><strong>Erros do dia:</strong> <%= dia.erros_do_dia || "-" %></li>
        <li><strong>Melhorar amanh√£:</strong> <%= dia.melhorar_amanha || "-" %></li>
        <li><strong>Ponto alto:</strong> <%= dia.ponto_alto_dia || "-" %></li>
        <li><strong>Maior vacilo:</strong> <%= dia.maior_vacilo_dia || "-" %></li>
      </ul>
    </div>

    <!-- META -->
    <div class="kst-card kst-day-section">
      <h3 class="kst-day-section-title">Meta do dia</h3>
      <ul class="kst-day-info">
        <li><strong>Meta principal:</strong> <%= dia.meta_principal_dia || "-" %></li>
        <li>
          <strong>Status:</strong>
          <% if (dia.status_meta === "SIM") { %> Cumprida
          <% } else if (dia.status_meta === "PARCIAL") { %> Parcial
          <% } else if (dia.status_meta === "NAO") { %> N√£o cumprida
          <% } else { %> - <% } %>
        </li>
      </ul>
    </div>

  </div>

  <!-- BOT√ïES -->
  <div class="kst-day-actions">
    <a href="/dias" class="kst-btn kst-btn-secondary">Voltar ao hist√≥rico</a>
    <a href="/dias/<%= dia.id %>/editar" class="kst-btn kst-btn-primary">Editar dia</a>
  </div>

</section>

<%- include("partials/footer") %>
