<%- include("partials/header", { tituloPagina: tituloPagina }) %>

<section class="kst-container">

  <!-- Cabeçalho -->
  <div class="kst-home-header" style="margin-bottom: 2rem;">
    <h1 class="kst-home-title"><%= materia.nome %></h1>
    <p class="kst-home-subtitle">Resumo geral de tudo que você estudou nessa matéria.</p>
  </div>

  <!-- GRID PRINCIPAL -->
  <div class="kst-grid-2">

    <!-- CARD 1 → Informações gerais -->
    <div class="kst-card kst-card-block">
      <h3 class="kst-block-title">Informações gerais</h3>

      <div class="kst-details-line"><strong>Nome:</strong> <%= materia.nome %></div>

      <div class="kst-details-line">
        <strong>Dias estudados:</strong> <%= resumo.diasEstudados %>
      </div>

      <div class="kst-details-line">
        <strong>Total de minutos:</strong> <%= resumo.totalMinutos %> min
      </div>

      <div class="kst-details-line">
        <strong>Horas totais:</strong> <%= resumo.horasTotais.toFixed(2) %> h
      </div>
    </div>

    <!-- CARD 2 → Questões -->
    <div class="kst-card kst-card-block">
      <h3 class="kst-block-title">Questões</h3>

      <div class="kst-details-line">
        <strong>Total feitas:</strong>
        <% if (resumo.totalQuestoes > 0) { %>
          <%= resumo.totalQuestoes %>
        <% } else { %>
          -
        <% } %>
      </div>

      <div class="kst-details-line">
        <strong>Certas:</strong>
        <% if (resumo.totalQuestoes > 0) { %>
          <%= resumo.totalCertas %>
        <% } else { %>
          -
        <% } %>
      </div>

      <div class="kst-details-line">
        <strong>Taxa de acerto:</strong>
        <% if (resumo.taxaAcerto != null) { %>
          <span class="kst-tag-success"><%= resumo.taxaAcerto %>%</span>
        <% } else { %>
          -
        <% } %>
      </div>
    </div>

  </div> <!-- fim grid -->

  <!-- LISTA DE TÓPICOS AGRUPADOS -->
  <% if (topicos && topicos.length > 0) { %>
    <div class="kst-card kst-card-block" style="margin-top: 2rem;">
      <h3 class="kst-block-title">Tópicos estudados</h3>

      <ul class="kst-topicos-list">
        <% topicos.forEach(function(t) { %>
          <li class="kst-topico-item">

            <div class="kst-topico-header">
              <div class="kst-topico-titulo">
                <span class="kst-topico-nome"><%= t.texto %></span>

                <% if (t.vezes > 1) { %>
                  <span class="kst-topico-vezes"><%= t.vezes %>x</span>
                <% } %>
              </div>

              <span class="kst-topico-minutos"><%= t.minutosTotal %> min</span>
            </div>

            <% if (t.primeiraData || t.ultimaData) { %>
              <div class="kst-topico-datas">
                <% if (t.primeiraData && t.ultimaData && t.primeiraData.toString() !== t.ultimaData.toString()) { %>
                  <span>
                    De <%= new Date(t.primeiraData).toLocaleDateString("pt-BR") %>
                    até <%= new Date(t.ultimaData).toLocaleDateString("pt-BR") %>
                  </span>
                <% } else { %>
                  <span>
                    Em <%= new Date(t.primeiraData || t.ultimaData).toLocaleDateString("pt-BR") %>
                  </span>
                <% } %>
              </div>
            <% } %>

          </li>
        <% }) %>
      </ul>

    </div>
  <% } %>

  <!-- AÇÕES -->
  <div class="kst-actions-row" style="margin-top: 1.5rem;">
    <a href="/materias" class="kst-btn kst-btn-secondary">Voltar</a>
    <a href="/materias/<%= materia.id %>/editar" class="kst-btn kst-btn-primary">Editar nome</a>
  </div>

</section>

<%- include("partials/footer") %>
